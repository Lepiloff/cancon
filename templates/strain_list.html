{% extends "base.html" %}

{% block content %}
  <div class="container" style="max-width: 1280px;">
    <h1 class="center-align">Strains</h1>
    <div class="row">
      {% for strain in strains %}
        <div class="col s12 m4">
          <div class="card">
            <div class="card-image">
              <img src="{{ strain.img.url }}" alt="{{ strain.name }}">
            </div>
            <div class="card-content">
              <span class="card-title">{{ strain.name }}</span>
              <p><strong>Category:</strong> {{ strain.category }}</p>
              <div class="rating" data-rating="{{ strain.rating }}"></div>
              <p><strong>THC:</strong> {{ strain.thc }}%</p>
              {% if strain.cbd %}
                <p><strong>CBD:</strong> {{ strain.cbd }}%</p>
              {% elif strain.cbg %}
                <p><strong>CBG:</strong> {{ strain.cbg }}%</p>
              {% endif %}
            </div>
            <div class="card-action">
              <a href="{% url 'strain_detail' slug=strain.slug %}">View Details</a>
            </div>
          </div>
        </div>
        {% if forloop.counter|divisibleby:"3" and not forloop.last %}
          </div><div class="row">
        {% endif %}
      {% endfor %}
    </div>

    {% if strains.paginator.num_pages > 1 %}
      <ul class="pagination center-align">
        {% if strains.has_previous %}
          <li class="waves-effect"><a href="?page=1">&laquo;</a></li>
          <li class="waves-effect"><a href="?page={{ strains.previous_page_number }}">‹</a></li>
        {% else %}
          <li class="disabled"><a>&laquo;</a></li>
          <li class="disabled"><a>‹</a></li>
        {% endif %}

        {% for i in strains.paginator.page_range %}
          {% if strains.number == i %}
            <li class="active"><a>{{ i }}</a></li>
          {% else %}
            <li class="waves-effect"><a href="?page={{ i }}">{{ i }}</a></li>
          {% endif %}
        {% endfor %}

        {% if strains.has_next %}
          <li class="waves-effect"><a href="?page={{ strains.next_page_number }}">›</a></li>
          <li class="waves-effect"><a href="?page={{ strains.paginator.num_pages }}">&raquo;</a></li>
        {% else %}
          <li class="disabled"><a>›</a></li>
          <li class="disabled"><a>&raquo;</a></li>
        {% endif %}
      </ul>
    {% endif %}
  </div>
{% endblock %}
{% block extra_scripts %}
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      var ratingElements = document.querySelectorAll('.rating');

      ratingElements.forEach(function(ratingElement) {
        var rating = parseFloat(ratingElement.dataset.rating);
        var fullStars = Math.floor(rating);
        var halfStar = (rating - fullStars) >= 0.5;

        for (var i = 1; i <= 5; i++) {
          var star = document.createElement('span');
          star.classList.add('star');

          if (i <= fullStars) {
            star.classList.add('gold');
          } else if (i === fullStars + 1 && halfStar) {
            star.classList.add('half');
          }

          ratingElement.appendChild(star);
        }
      });
    });
  </script>
{% endblock %}
